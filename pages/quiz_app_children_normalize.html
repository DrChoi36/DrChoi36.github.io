<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>어린이 웹 성경 퀴즈 (13과)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Comic+Neue&display=swap');
    body { margin:0; padding:0; font-family:'Comic Sans MS','Comic Neue',sans-serif; background:#f0f8ff; display:flex; justify-content:center; align-items:center; min-height:100vh; font-size:32px; }
    #quiz-container { width:90%; max-width:600px; text-align:center; padding:10px 0; }
    .question-box,.input-box { padding:20px; border-radius:12px; color:#fff; transition:background-color .5s; }
    .input-box { background:#6B5B95; }
    .answer-section { margin-top:20px; }
    button { margin:5px; padding:10px 20px; font-size:32px; border:none; border-radius:8px; cursor:pointer; font-family:inherit; }
    input[type="text"] { padding:8px; font-size:32px; border-radius:5px; border:2px solid #ccc; width:80%; font-family:inherit; text-align:center; margin-bottom:20px; }
    #result { font-size:40px; margin-top:30px; color:#333; background:#F7CAC9; padding:20px; border-radius:12px; }
    #feedback { min-height:50px; margin-top:15px; font-size:36px; }
  </style>
</head>
<body>
  <div id="quiz-container">
    <div id="name-input-area" class="input-box">
      <input type="text" id="name-input" placeholder="이름 입력" />
      <button id="start-btn">시작</button>
    </div>

    <div id="question-number" style="display:none;"></div>
    <div id="question-text" class="question-box" style="display:none;"></div>
    <div id="answer-area" class="answer-section" style="display:none;"></div>
    <div id="feedback" style="display:none;"></div>
    <div id="result" style="display:none;"></div>
  </div>

  <div class="app-footer">
    Distributed by Dr Choi
  </div>
  
  <script>
  'use strict';

  const nameInputArea   = document.getElementById('name-input-area');
  const nameInput       = document.getElementById('name-input');
  const startBtn        = document.getElementById('start-btn');
  const questionNumberEl= document.getElementById('question-number');
  const questionTextEl  = document.getElementById('question-text');
  const answerAreaEl    = document.getElementById('answer-area');
  const feedbackEl      = document.getElementById('feedback');
  const resultEl        = document.getElementById('result');

  const themes = ['#FF6F61', '#6B5B95', '#88B04B', '#F7CAC9'];

  // [수정됨] 13과 내용에 맞춘 문제 목록
  const questions = [
    // 1번: OX 문제 (중심 생각)
    { 
      type:'ox',   
      question:'우리가 예수님과 매일 시간을 함께 보낼 때, 우리는 하나님의 구원의 선물을 받아들이게 됩니다.', 
      answer:'O' 
    }, 
    // [근거: source 96] "우리가 예수님과 매일 시간을 함께 보낼 때 우리는 하나님의 구원의 선물을 받아들이게 됩니다."

    // 2번: 기억절 문제 (예레미야 29:11)
    { 
      type:'fill', 
      question:'기억절: "너희를 향한 나의 생각을 내가 아나니 (   )이요 재앙이 아니니라 너희에게 미래와 희망을 주는 것이니라" (예레미야 29:11)', 
      answer:'평안' 
    },
    // [근거: source 98] "...평안이요 재앙이 아니니라..."

    // 3번: 4지 선다형 (이야기 내용 - 베들레헴의 의미)
    { 
      type:'mcq',  
      question:'제임스 선생님의 설명에서 예수님이 태어나신 "베들레헴"의 뜻은 무엇이라고 했나요?', 
      options:['A. 평화의 집', 'B. 떡집', 'C. 왕의 도시', 'D. 천사의 마을'], 
      answer:'B. 떡집'
    },
    // [근거: source 110] "여러분은 베들레헴이 떡집의 의미라는 것을 알고 있었나요?"

    // 4번: 4지 선다형 (적용 - 기도문)
    { 
      type:'mcq',  
      question:'매일 하나님께 자신을 드리기 위한 기도문에서 "오늘 저를 온전히 ( )의 것으로 취하소서"라고 기도합니다. 빈칸에 알맞은 말은?', 
      options:['A. 세상', 'B. 부모님', 'C. 주(예수님)', 'D. 친구'], 
      answer:'C. 주(예수님)' 
    },
    // [근거: source 171] "사랑의 주님, 오늘 저를 온전히 주의 것으로 취하소서."

    // 5번: 단답형 (핵심 단어 - 예레미야 29:13, 퍼즐 제목)
    { 
      type:'short',
      question:'예레미야 29장 13절에서 "너희가 온 ( )으로 나를 구하면 나를 찾을 것이요 나를 만나리라"고 했습니다. 빈칸에 들어갈 두 글자 단어는?', 
      answer:'마음' 
    },
    // [근거: source 98] "너희가 온 마음으로 나를 구하면..."

    // 6번: 느낀점
    { 
      type:'any',  
      question:'13과를 공부하며 느낀 점이나 다짐을 1줄 이상 써주세요.' 
    }
  ];

  let participantName = '';
  let current = 0;
  let score = 0;

  startBtn.addEventListener('click', startGame);
  nameInput.addEventListener('keydown', (event) => { if (event.key === 'Enter') startGame(); });

  // 정규화 함수: 전각/반각, 대소문자, 구두점·공백 제거, 한글 쌍자음 단자음화
  function normalize(str) {
    if (!str) return '';
    let out = str.normalize('NFKC').toLowerCase();

    const map = { 'ㄲ':'ㄱ', 'ㄸ':'ㄷ', 'ㅃ':'ㅂ', 'ㅆ':'ㅅ', 'ㅉ':'ㅈ' };
    out = out.split('').map(ch => map[ch] ?? ch).join('');

    out = out.replace(/[\p{P}\p{S}]/gu, ''); // 구두점·기호 제거
    out = out.replace(/\s+/g, '');           // 모든 공백 제거
    return out;
  }

  // 비교 함수
  function isSameAnswer(user, gold) {
    // 괄호 안에 있는 정답(예: "주(예수님)") 처리
    let cleanGold = gold;
    if(gold.includes('(')) {
        cleanGold = gold.split('(')[0]; // 괄호 앞부분만 정답으로 인정하거나
    }
    // 객관식 답안("B. 떡집") 처리 - 앞의 알파벳 제거하고 비교하거나, 전체 비교
    // 여기서는 단순화하여 정규화된 문자열끼리 비교
    return normalize(user) === normalize(gold) || normalize(user) === normalize(cleanGold);
  }

  function startGame() {
    const nameVal = nameInput.value.trim();
    if (!nameVal) return alert('이름을 입력해주세요');

    participantName = nameVal;
    nameInputArea.style.display = 'none';
    questionNumberEl.style.display = 'block';
    questionTextEl.style.display = 'block';
    answerAreaEl.style.display = 'block';
    feedbackEl.style.display = 'block';
    showQuestion();
  }

  function showQuestion() {
    feedbackEl.textContent = '';
    const q = questions[current];

    questionNumberEl.textContent = `문제 ${current + 1} / ${questions.length}`;
    questionTextEl.style.backgroundColor = themes[current % themes.length];
    questionTextEl.textContent = q.question;

    answerAreaEl.innerHTML = '';

    if (q.type === 'ox') {
      ['O','X'].forEach(opt => {
        answerAreaEl.appendChild(createButton(opt, () => processAnswer(opt)));
      });
    } else if (q.type === 'mcq') {
      q.options.forEach(opt => {
        const btn = createButton(opt, () => processAnswer(opt));
        btn.style.cssText = 'display:block; width:90%; margin:10px auto;';
        answerAreaEl.appendChild(btn);
      });
    } else {
      const input = document.createElement('input');
      input.type = 'text';
      input.id = `${q.type}-input`;
      answerAreaEl.appendChild(input);

      const submitBtn = createButton('제출', () => processAnswer(input.value));
      answerAreaEl.appendChild(submitBtn);

      input.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') processAnswer(input.value);
      });
      input.focus();
    }
  }

  function createButton(text, onClick) {
    const btn = document.createElement('button');
    btn.textContent = text;
    btn.addEventListener('click', onClick);
    return btn;
  }

  function processAnswer(userAns) {
    if (answerAreaEl.querySelector('button:disabled')) return;

    const q = questions[current];
    const trimmedUserAns = userAns ? userAns.trim() : '';
    let isCorrect = false;

    if (q.type === 'any') {
      isCorrect = trimmedUserAns.length > 0;        // 자유서술은 빈칸만 아니면 OK
    } else {
      // 객관식은 전체 텍스트 비교, 주관식은 정규화 비교
      if (q.type === 'mcq') {
         isCorrect = (userAns === q.answer);
      } else {
         isCorrect = isSameAnswer(trimmedUserAns, q.answer);
      }
    }

    feedbackEl.textContent = isCorrect ? '정답입니다! ✅' : '틀렸습니다! ❌';
    if (isCorrect) score++;

    answerAreaEl.querySelectorAll('button, input').forEach(el => el.disabled = true);
    showNextButton();
  }

  function showNextButton() {
    const isLastQuestion = current === questions.length - 1;
    const buttonText = isLastQuestion ? '결과 보기' : '다음 문제';

    const nextBtn = createButton(buttonText, () => {
      if (isLastQuestion) {
        showResult();
      } else {
        current++;
        showQuestion();
      }
      nextBtn.remove();
    });
    nextBtn.style.cssText = 'display:block; margin:20px auto;';
    feedbackEl.parentNode.insertBefore(nextBtn, feedbackEl.nextSibling);
  }

  function showResult() {
    questionNumberEl.style.display = 'none';
    questionTextEl.style.display = 'none';
    answerAreaEl.style.display = 'none';
    feedbackEl.style.display = 'none';

    resultEl.style.display = 'block';
    resultEl.innerHTML = `${participantName}님<br>13과 퀴즈 결과: ${score} / ${questions.length}점`;
  }
  </script>
</body>
</html>

